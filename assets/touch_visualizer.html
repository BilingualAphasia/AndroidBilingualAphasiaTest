<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- Including the Lobster font from Google's Font Directory -->

<STYLE type="text/css">
@font-face {
  font-family: 'Lobster';
  font-style: normal;
  font-weight: normal;
  src: local('Lobster'), url('google_lobster_font.woff') format('woff');
}
@font-face {
  font-family: 'Lobster';
  font-style: normal;
  font-weight: normal;
  src: local('Lobster'), url('http://themes.googleusercontent.com/static/fonts/lobster/v3/NIaFDq6p6eLpSvtV2DTNDQLUuEpTyoUstqEm5AMlJo4.woff') format('woff');
}
input.groovybutton
{
	 font-size:8px;
   color:#FFFFFF;
   background-color:#006633;
   border-style:double;
   border-color:#fff;
}
</STYLE>


<link href='http://fonts.googleapis.com/css?family=Merienda+One' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="imagegallery/MooFlow.css" />
<link rel="stylesheet" type="text/css" href="imagegallery/styles.css" />
<script type="text/javascript" src="imagegallery/mootools-1.2-core.js"></script>
<script type="text/javascript" src="imagegallery/mootools-1.2-more.js"></script>
<script type="text/javascript" src="imagegallery/MooFlow.js"></script>

<script>
	var addresponses;
	var addStimuli;
	var addSubExperiments;
	var subExperiments = [];
	var titleFont;
	var titleLabel;
	var labelFont;
	var viewstimulus;
	var ctx;

	var pause = false;
	var timer;
	var stopLooping = function() {
		clearInterval(timer);
	}
	var buttonRadiusForClicking;
	var pushButton = function(id) {
		//to be defined later
	}
	var getPositionAsButton = function(x, y) {
		//to be defined later
	}
	var participantCodes;
	var setReplayParticipantCode;
	var subExperimentLabels = [];
	var menuShape = "arc"; //arc or circle

	var randomColor = function() {
		//return 'hs1('+Math.floor(Math.random() * 360) + ',100%,50%)';
		//return '#'+Math.floor(Math.random() * 360);
		return '#000000'.replace(/0/g, function() {
			return (~~(Math.random() * 16)).toString(16);
		})
		//return '#'+Math.floor(Math.random()*16777215).toString(16);
	}
	var randomBlueGreenColor = function() {
		return 'hs1(' + Math.floor(Math.random() * 100 + 100) + ',100%,50%)';
	}
	var srandom = function() {
		return Math.random() * 2 - 1;
	}
	Response = function() {
		this.id = 0;
		this.x = 0;
		this.y = 0;
		this.userid = 0;
		this.reactionTime = 0;
		this.label = "";
		this.stimuli = "";
		this.init = function(i) {
			this.id = i;
			this.color = randomColor();
			this.x = Math.random() * ctx.canvas.width;
			this.y = Math.random() * ctx.canvas.height;
			var maxButtonSize = Math.max(buttonRadiusForClicking - 10, 3);
			this.r = Math.random() * (8) + maxButtonSize;
		}
		this.draw = function() {
			ctx.fillStyle = this.color;
			ctx.beginPath();
			ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2, false);
			ctx.closePath();
			ctx.fill();
		}
	}
	Stimulus = function() {
		this.id = 0;
		this.label = "";
		this.imagex = "";
		this.image = "";
		this.windowxsize = 0;
		this.windowysize = 0;
		this.responses = [];
		this.init = function(i) {
			this.id = i;
		}
		this.draw = function(){
			
		}
	}
	SubExperiment = function() {
		this.id = 0;
		this.label = "";
		this.stimuli = [];
		this.init = function(i) {
			this.id = i;
		}
		this.draw = function(){
			
		}
	}

	function addresponses(n, stimulus) {
		for ( var i = 0; i < n; i++) {
			var e = new Response();
			e.init(i);
			stimulus.responses.push(e);
		}
	}
	function addStimuli(n, subexperiment) {
		for ( var i = 0; i < n; i++) {
			var e = new Stimulus();
			e.init(i);
			subexperiment.stimuli.push(e);
		}
	}
	function addSubExperiments(n) {
		for ( var i = 0; i < n; i++) {
			var e = new SubExperiment();
			e.init(i);
			e.label = subExperimentLabels[n];
			subExperiments.push(e);
		}
	}
	function clearBubbles(bubbleType) {
		var n = bubbleType.length;
		for ( var i = 0; i < n; i++) {
			bubbleType.pop();
		}
	}

	function isNativeAndroidApp() {
		return /BilingualAphasiaTest\/[0-9\.]+$/.test(navigator.userAgent);
	}
	if (isNativeAndroidApp()) {
		window.pressButton = function(id, label) {
			if (label === "Start" || label === "Commencer") {
				Android.setAutoAdvanceJS("1");
			}
			Android.launchSubExperimentJS(id);
		}
		fetchSubExperimentsArray = function() {
			result = Android.fetchSubExperimentsArrayJS();
			result = result.replace(/\]/g, "").replace(/\[/g, "");
			subExperimentLabels = result.split(", ");//"History of Bilingualism","English Background","Spontaneous Speech","Verbal Comprehension","Pointing","Simple and Semi-complex Commands","Complex Commands","Verbal Auditory Discrimination","Syntactic Comprehension","Semantic Categories","Synonyms","Antonyms","Grammaticality Judgement","Semantic Acceptability","Lexical Decision","Series","Verbal Fluency","Naming","Sentence Construction","Semantic Opposites","Derivational Morphology","Morphological Opposites","Description","Mental Arithmetic","Listening Comprehension","Reading","Copying","Dictation","Reading Comprehension for Words","Reading Comprehension for Sentences","Writing");
			console.log(subExperimentLabels);
			if (subExperimentLabels.length > 8) {
				menuShape = "circle";
			}
			//Android.showToast(subExperimentLabels);
		}
		fetchExperimentTitle = function() {
			titleLabel = Android.fetchExperimentTitleJS();
		}
		fetchParticipantCodes = function() {
			result = Android.fetchParticipantCodesJS();
			result = result.replace(/\]/g, "").replace(/\[/g, "");
			if (result.length > 0) {
				participantCodes = result.split(", ");//"ET1AM4mc, SAMPLE".split(",");
			} else {
				participantCodes = "";
			}
		}
		setReplayParticipantCode = function(code) {
			Android.setReplayParticipantCodeJS(code);
		}
	} else {
		//alert("in a browser");
		window.pressButton = function(id, label) {
			if (label === "Start" || label === "Commencer") {
				alert("Starting AutoAdvance - pressed experiment button " + id);
			} else {
				alert("pressed experiment button " + id);
			}
		}
		fetchSubExperimentsArray = function() {
			var javaArrayListToString = "[History of Bilingualism, English Background, Spontaneous Speech, Verbal Comprehension, Pointing, Simple and Semi-complex Commands, Complex Commands, Verbal Auditory Discrimination, Syntactic Comprehension, Semantic Categories, Synonyms, Antonyms, Grammaticality Judgement, Semantic Acceptability, Lexical Decision, Series, Verbal Fluency, Naming, Sentence Construction, Semantic Opposites, Derivational Morphology, Morphological Opposites, Description, Mental Arithmetic, Listening Comprehension, Reading, Copying, Dictation, Reading Comprehension for Words, Reading Comprehension for Sentences, Writing]";
			javaArrayListToString = javaArrayListToString.replace(/\]/g, "")
					.replace(/\[/g, "");
			subExperimentLabels = javaArrayListToString.split(",");
			console.log(subExperimentLabels);
			addSubExperiments(subExperimentLabels.length);

		}
		fetchExperimentTitle = function() {
			titleLabel = "Bilingual Aphasia Test - English";
		}
		fetchParticipantCodes = function() {
			participantCodes = 'ET1AM4mc, SAMPLE'.split(",");
		}
		setReplayParticipantCode = function(code) {
			console.log("IN set replay button");
			alert("Set replay participant to " + code);
		}
	}

	loadButton = function() {
		fetchSubExperimentsArray();
		fetchExperimentTitle();
		addSubExperiments(subExperimentLabels.length);
		var img = new Image();
		img.src = '../res/drawable/x.jpg';
		ctx.drawImage(img, 0, 0,200,200);
		//var img2 = new Image();
		//img2.src = '../res/drawable/e048_e408.jpg';
		//ctx.drawImage(img2, 400, 0,200,200);
		getPositionAsButton = function(x, y, buttonid, responses) {
			/*
			If recieved a button id, flash that button
			and press it 500ms later
			 */
			if (buttonid != null) {
				for ( var k = 0; k < responses.length; k++) {
					if (responses[k].id === buttonid) {
						responses[k].color = "#999999";
						responses[k].r = buttonRadiusForClicking;
						responses[k].draw()
						ctx.textAlign = responses[k].textAlign;
						ctx.fillText(responses[k].label, responses[k].labelx,
								responses[k].labely);
						//alert("Clicked "+responses[k].id);
						setTimeout("window.pressButton(responses[" + k
								+ "].id,responses[" + k + "].label);", 500);
						return;//dont click on multiple buttons
					} else {
						//alert(" distance to this position "+d);
						//alert("Position filled is at "+responses[k].x+" "+responses[k].y);
					}
				}
			}
			/*
			Otherwise check to see if the x,y match a button
			 */

			for ( var k = 0; k < responses.length; k++) {
				var dx = x - responses[k].x;
				var dy = y - responses[k].y;
				var d = Math.sqrt(dx * dx + dy * dy);
				var R = buttonRadiusForClicking;// responses[k].r + 5;//added 10 pixles to click around the buton
				if (d < R) {
					responses[k].color = "#aaaaaa";
					responses[k].r = buttonRadiusForClicking;
					responses[k].draw();
					ctx.textAlign = responses[k].textAlign;
					ctx.fillText(responses[k].label, responses[k].labelx,
							responses[k].labely);
					//alert("Clicked "+responses[k].id);
					setTimeout("window.pressButton(responses[" + k
							+ "].id,responses[" + k + "].label);", 0);
					return;//dont click on multiple buttons
				} else {
					//alert(" distance to this position "+d);
					//alert("Position filled is at "+responses[k].x+" "+responses[k].y);
				}
			}
		}
		ctx.canvas.addEventListener('touchstart', function(e) {
			//alert(e.changedresponses[0].pageX + " " + e.changedresponses[0].pageY);
			getPositionAsButton(e.pageX, e.pageY);
		});
		ctx.canvas.addEventListener('mousedown', function(e) {
			console.log(e);
			//alert(e.pageX + " " + e.pageY);
			getPositionAsButton(e.pageX, e.pageY);
		});

	}
	initCanvas = function() {
		canvasWidth = 1280;
		canvasHeight = 800;
		viewstimulus = document.getElementById("a");
		viewstimulus.setAttribute("width", canvasWidth);
		viewstimulus.setAttribute("height", canvasHeight);

		window.ctx = viewstimulus.getContext("2d");
		ctx.clearRect(0, 0, canvasWidth, canvasHeight);
		loadButton();
	}
</script>

</head>
<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<div id="content">
	<div class="half left">
		<div class="MooFlowieze">
			<div><img src="../res/drawable/x.jpg" title="ball" alt="Lautsprecherturm" /></div>
		    <div><img src="../res/drawable/e048_e408.jpg" title="ball" alt="Lautsprecherturm" /></div>
		    <div><img src="../res/drawable/e049_e409.jpg" title="ball" alt="Lautsprecherturm" /></div>
		    <div><img src="../res/drawable/e051.jpg" title="brew" alt="A deginer must have." /></div>
		    <div><img src="../res/drawable/e052_e410.jpg" title="thick" alt="Tropfen" /></div>
		    <div><img src="../res/drawable/e053_e411.jpg" title="knees, `s is scho arg verÃ¤ndert..." alt="...aber ratet mal was das is.." /></div>
    
		</div>
	</div>
	
</div>

<table cellpadding="0" cellspacing="0" border="0" width="100%"><tr valign="top"><td>
<!-- <canvas id="homeCanvas"> </canvas>-->
<canvas id="a" style="z-index: -1, background: #fff, top: 60;"  width="10" height="10">
</canvas>
</td><td id="sidebar" width="30">
<center>
<p>&nbsp;</p>
<span style="font-size: .75em;" style="font-family: helvetica, sans-serif;" id="buttonArea">
<div id='layer1' style='z-index: 10, background: #ffa;'>
	<input type="button" name="groovybtn1" id="loadButton" class="groovybutton" title="" value="Load" onClick="initCanvas()" />
</div>
</span>
</center>
</td></tr></table>

</body>

</html>
